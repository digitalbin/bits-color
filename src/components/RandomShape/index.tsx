import { useEffect, useRef } from "react";
import { animate, motion, useMotionValue } from "framer-motion";
import { interpolate } from "flubber";
import { isValidHex } from "@/utils";

interface Props {
  color: string;
}

const paths = [
  "M197.167 89.9702L157.81 21.6722C155.947 18.4283 153.261 15.7333 150.023 13.8596C146.785 11.9858 143.111 10.9996 139.37 11.0006H60.6566C56.9406 10.9734 53.2825 11.9209 50.0469 13.7484C46.8114 15.5759 44.1114 18.2197 42.2162 21.4161L2.85941 89.7141C0.986177 92.9586 0 96.6391 0 100.386C0 104.132 0.986177 107.812 2.85941 111.057L42.2162 179.355C44.0965 182.577 46.7886 185.25 50.0242 187.108C53.2598 188.965 56.9257 189.942 60.6566 189.941H139.37C143.076 189.968 146.725 189.03 149.958 187.219C153.192 185.408 155.898 182.786 157.81 179.611L197.167 111.313C199.023 108.063 200 104.385 200 100.642C200 96.8986 199.023 93.2203 197.167 89.9702Z",
  "M192.097 80.3874L118.983 7.27263C108.171 -2.42421 91.7925 -2.42421 80.9809 7.27263L7.86645 80.2996C-2.62215 90.796 -2.62215 107.805 7.86645 118.302L80.9809 191.329C83.4475 193.869 86.4022 195.884 89.6674 197.254C92.9327 198.623 96.4411 199.318 99.9817 199.297C103.51 199.341 107.011 198.673 110.275 197.334C113.54 195.995 116.501 194.012 118.983 191.504L192.097 118.389L192.207 118.28C202.641 107.786 202.592 90.8206 192.097 80.3874Z",
  "M71.5582 16.335C84.3362 -5.445 115.825 -5.445 128.603 16.335L129.067 17.125C131.965 22.0642 136.096 26.1663 141.055 29.0298C146.014 31.8932 151.632 33.4197 157.358 33.46L158.276 33.466C183.527 33.643 199.271 60.912 186.798 82.869L186.345 83.666C183.517 88.6452 182.03 94.2735 182.03 100C182.03 105.726 183.517 111.355 186.345 116.334L186.798 117.131C199.271 139.088 183.527 166.357 158.276 166.534L157.358 166.54C151.632 166.58 146.014 168.107 141.055 170.97C136.096 173.833 131.965 177.935 129.067 182.874L128.603 183.665C115.825 205.445 84.3362 205.445 71.5582 183.665L71.0942 182.874C68.1961 177.935 64.0654 173.833 59.1062 170.97C54.147 168.107 48.5294 166.58 42.8032 166.54L41.8862 166.534C16.6352 166.357 0.891165 139.088 13.3632 117.131L13.8162 116.334C16.6446 111.355 18.1316 105.726 18.1316 100C18.1316 94.2735 16.6446 88.6452 13.8162 83.666L13.3632 82.869C0.890165 60.912 16.6352 33.643 41.8862 33.466L42.8032 33.46C48.5293 33.4197 54.1468 31.8932 59.1058 29.0299C64.0648 26.1667 68.1954 22.0649 71.0932 17.126L71.5582 16.335Z",
  "M122.363 90.35C120.092 93.0526 118.846 96.4697 118.846 100C118.846 103.53 120.092 106.947 122.363 109.65L160.767 155.349C168.968 165.108 162.031 180 149.284 180H51.029C38.282 180 31.3449 165.108 39.5449 155.349L77.9499 109.65C80.2211 106.947 81.4662 103.53 81.4662 100C81.4662 96.4698 80.2211 93.0527 77.9499 90.35L39.5449 44.65C31.3449 34.892 38.2819 20 51.03 20H149.285C162.031 20 168.969 34.892 160.768 44.65L122.363 90.35Z",
  "M184.134 28.4133C173.781 17.1844 159.575 11 144.13 11C132.585 11 122.013 14.65 112.704 21.8477C108.008 25.4805 103.752 29.9258 100 35.1133C96.2492 29.927 91.9922 25.4805 87.2941 21.8477C77.9875 14.65 67.4148 11 55.8699 11C40.425 11 26.2176 17.1844 15.8645 28.4133C5.63516 39.5109 0 54.6723 0 71.1059C0 88.0199 6.30351 103.504 19.8363 119.833C31.9426 134.441 49.3422 149.269 69.4914 166.44C76.3719 172.304 84.1707 178.95 92.2684 186.03C94.408 187.904 97.1557 188.937 100 188.936C102.843 188.937 105.589 187.906 107.729 186.034C115.826 178.952 123.63 172.302 130.513 166.435C150.659 149.267 168.059 134.441 180.165 119.832C193.698 103.504 200 88.0203 200 71.1043C200 54.6723 194.365 39.5109 184.134 28.4133Z",
  "M164.134 81.4282L53.0418 5.37491C47.9114 1.86017 42.7421 0 38.4454 0C30.1385 0 25 6.66683 25 17.8262V182.2C25 193.346 30.1321 200 38.4195 200C42.7226 200 47.8094 198.138 52.9511 194.614L164.095 118.562C171.243 113.663 175.201 107.071 175.201 99.9911C175.203 92.9163 171.29 86.3256 164.134 81.4282Z",
  "M199.913 68.3313C199.814 67.6938 199.612 67.0697 199.366 66.4688C199.311 66.3388 199.311 66.2062 199.253 66.0744C199.244 66.0655 199.237 66.0557 199.231 66.045C199.231 66.0304 199.223 66.0231 199.216 66.0139L177.098 19.0494C177.047 18.9413 176.951 18.8442 176.893 18.7343C176.816 18.6024 176.79 18.4412 176.705 18.3105C176.537 18.0247 176.306 17.8025 176.107 17.5478C175.906 17.2859 175.722 17.0031 175.499 16.7711C175.169 16.4267 174.791 16.133 174.406 15.8466C174.164 15.6561 173.937 15.4454 173.673 15.2909C173.226 15.0216 172.742 14.8293 172.25 14.6454C172.005 14.552 171.766 14.4091 171.509 14.3377C170.737 14.1162 169.937 14.0026 169.133 14H38.7819C38.0082 14 37.2584 14.1081 36.5287 14.2986C36.274 14.3664 36.0414 14.4989 35.7898 14.585C35.3428 14.7535 34.8842 14.9007 34.4647 15.1407C34.1966 15.2952 33.9768 15.5016 33.727 15.6707C33.3674 15.9254 32.9955 16.169 32.6761 16.4774C32.4508 16.699 32.2713 16.961 32.071 17.2108C31.8347 17.488 31.558 17.739 31.3651 18.0541L1.32757 65.0198C1.21583 65.203 1.1627 65.4106 1.06133 65.6048C0.975233 65.7586 0.832343 65.8905 0.757234 66.0591C0.678461 66.2356 0.674797 66.4206 0.599688 66.5891C0.44001 67.015 0.30944 67.4511 0.208877 67.8947C0.131985 68.2409 0.0732828 68.5908 0.0330124 68.9431C-0.00455841 69.3828 -0.0100688 69.8247 0.016525 70.2652C0.044004 70.6267 0.0696509 70.9821 0.126441 71.3338C0.205214 71.7661 0.341387 72.1716 0.478781 72.5881C0.603352 72.9422 0.7151 73.2958 0.882416 73.6298C0.937374 73.7452 0.961189 73.8771 1.01615 73.9962C1.17369 74.2893 1.40635 74.5189 1.59931 74.7827C1.75319 75.0117 1.84662 75.2523 2.02248 75.4575L92.8103 182.691C94.376 184.538 96.7227 185.851 99.0621 185.785C99.0914 185.785 99.1213 185.799 99.1409 185.799C99.2715 185.807 99.3961 185.807 99.528 185.807H99.5463C100.331 185.807 101.101 185.66 101.842 185.462C102.062 185.393 102.26 185.323 102.48 185.239C103.032 185.043 103.562 184.792 104.064 184.491C104.232 184.392 104.412 184.293 104.577 184.182C105.175 183.768 105.736 183.291 106.22 182.716L197.94 75.485C198.057 75.3457 198.124 75.1772 198.226 75.03C198.373 74.845 198.556 74.6911 198.681 74.4817C198.813 74.2747 198.879 74.042 198.989 73.8203C199.143 73.5364 199.289 73.25 199.403 72.9422C199.576 72.4953 199.693 72.0415 199.796 71.5872C199.862 71.2789 199.936 70.9857 199.965 70.678C200.023 70.1718 200.001 69.6784 199.965 69.1764C199.943 68.8796 199.957 68.6024 199.913 68.3313Z",
  "M170 127.098C170 166.036 138.66 197.602 100 197.602C61.34 197.602 30 166.036 30 127.098C30 90.2411 65.84 45.8081 95.113 4.55612C97.513 1.17512 102.538 1.14112 104.974 4.49612C135.351 46.3391 170 90.1931 170 127.098Z",
  "M89.931 6.129C94.156 -2.043 105.842 -2.043 110.067 6.129L136.972 58.164C138.05 60.2497 139.749 61.949 141.835 63.027L193.87 89.932C202.042 94.157 202.042 105.843 193.87 110.068L141.835 136.973C139.749 138.051 138.05 139.75 136.972 141.836L110.067 193.871C105.842 202.043 94.156 202.043 89.931 193.871L63.026 141.836C61.948 139.75 60.2487 138.051 58.163 136.973L6.129 110.068C-2.043 105.843 -2.043 94.157 6.129 89.932L58.164 63.027C60.2495 61.9487 61.9487 60.2495 63.027 58.164L89.931 6.13V6.129Z",
  "M144.673 62.4273C108.974 40.7082 125.714 10.0531 126.433 8.77891C126.945 7.888 127.214 6.87808 127.213 5.85047C127.211 4.82286 126.939 3.81372 126.425 2.92431C125.91 2.0349 125.17 1.29651 124.28 0.783228C123.39 0.269949 122.38 -0.000162352 121.353 7.32102e-08C102.977 7.32102e-08 88.5867 5.22109 78.5832 15.5191C61.4898 33.1145 62.2828 60.5 62.6215 72.1941C62.6594 73.4898 62.6914 74.609 62.6914 75.4406C62.6914 84.1234 64.0844 92.1391 65.3137 99.2117C66.1059 103.77 66.7898 107.705 66.9117 110.799C67.0418 114.112 66.4367 114.871 66.4113 114.902C66.325 115.005 65.6059 115.387 63.6629 115.387C61.4465 115.387 59.8129 114.663 58.3648 113.039C52.7102 106.698 52.3191 89.3855 53.4004 79.9664C53.4959 79.1454 53.4166 78.3135 53.1677 77.5253C52.9189 76.7372 52.5061 76.0106 51.9564 75.3933C51.4068 74.776 50.7328 74.282 49.9787 73.9437C49.2245 73.6054 48.4074 73.4305 47.5809 73.4305C32.368 73.4305 21 98.3086 21 120.552C21 131.009 23.1035 141.252 27.2516 150.998C31.2617 160.419 36.9797 168.921 44.2484 176.27C59.3848 191.572 79.343 200 100.446 200C121.634 200 141.587 191.691 156.63 176.606C171.634 161.559 179.897 141.652 179.897 120.552C179.897 93.6293 158.832 71.0414 144.673 62.4273Z",
];

export default function RandomShape(props: Props) {
  const { color } = props;
  const pathRef = useRef<SVGPathElement>(null);
  const pathIndex = useRef<number>(0);
  const progress = useMotionValue(0);

  useEffect(() => {
    const path = interpolate(
      paths[pathIndex.current],
      paths[pathIndex.current + 1] || paths[0]
    );
    animate(progress, 1, {
      duration: 0.2,
      onComplete: () => {
        if (pathIndex.current >= paths.length - 1) pathIndex.current = 0;
        else pathIndex.current += 1;
        progress.set(0);
      },
      onUpdate: (v) => {
        pathRef.current?.setAttribute("d", path(v));
      },
    });
  }, [color, progress]);

  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      className="w-full h-full"
      viewBox="0 0 200 200"
      version="1.1"
    >
      {isValidHex(color) ? (
        <motion.g
          key={color}
          animate={{ rotate: [-45, 0] }}
          transition={{ duration: 0.2 }}
          style={{ originX: "50%", originY: "50%" }}
        >
          <motion.path animate={{ fill: color }} ref={pathRef} />
        </motion.g>
      ) : (
        <InvalidHexPaths />
      )}
    </svg>
  );
}

function InvalidHexPaths() {
  return (
    <motion.g
      className="fill-red-400"
      animate={{ x: [-10, 10, -5, 5, 0] }}
      transition={{ duration: 0.2 }}
    >
      <path d="M109.375 25.375C109.375 20.1895 105.186 16 100 16C94.8145 16 90.625 20.1895 90.625 25.375V100.375C90.625 105.561 94.8145 109.75 100 109.75C105.186 109.75 109.375 105.561 109.375 100.375V25.375ZM100 147.25C103.108 147.25 106.089 146.015 108.286 143.818C110.484 141.62 111.719 138.639 111.719 135.531C111.719 132.423 110.484 129.443 108.286 127.245C106.089 125.047 103.108 123.812 100 123.812C96.892 123.812 93.9113 125.047 91.7136 127.245C89.5159 129.443 88.2812 132.423 88.2812 135.531C88.2812 138.639 89.5159 141.62 91.7136 143.818C93.9113 146.015 96.892 147.25 100 147.25Z" />
      <path d="M32.1511 167.716V178.625H29.1895V167.716H32.1511Z" />
      <path d="M42.9936 167.716V178.625H40.522L36.5803 172.893H36.5163V178.625H33.5547V167.716H36.0689L39.9467 173.426H40.032V167.716H42.9936Z" />
      <path d="M47.3775 167.716L49.6147 175.408H49.6999L51.9371 167.716H55.2823L51.6815 178.625H47.6332L44.0323 167.716H47.3775Z" />
      <path d="M57.3797 178.625H54.1837L57.7845 167.716H61.8328L65.4337 178.625H62.2377L59.8513 170.72H59.7661L57.3797 178.625ZM56.7831 174.321H62.7916V176.537H56.7831V174.321Z" />
      <path d="M66.4844 178.625V167.716H69.446V176.239H73.8565V178.625H66.4844Z" />
      <path d="M78.0154 167.716V178.625H75.0537V167.716H78.0154Z" />
      <path d="M83.6164 178.625H79.4189V167.716H83.5738C84.6959 167.716 85.6654 167.934 86.4822 168.371C87.3025 168.804 87.9346 169.429 88.3785 170.246C88.8259 171.059 89.0496 172.034 89.0496 173.17C89.0496 174.307 88.8277 175.283 88.3838 176.1C87.9399 176.913 87.3113 177.538 86.4981 177.975C85.6849 178.408 84.7243 178.625 83.6164 178.625ZM82.3806 176.111H83.5099C84.0496 176.111 84.5095 176.024 84.8895 175.85C85.273 175.676 85.5642 175.376 85.7631 174.95C85.9655 174.523 86.0667 173.93 86.0667 173.17C86.0667 172.411 85.9637 171.817 85.7577 171.391C85.5553 170.965 85.257 170.665 84.8628 170.491C84.4722 170.317 83.9928 170.23 83.4246 170.23H82.3806V176.111Z" />
      <path d="M93.4082 178.625V167.716H96.3699V171.977H100.29V167.716H103.252V178.625H100.29V174.364H96.3699V178.625H93.4082Z" />
      <path d="M104.658 178.625V167.716H112.52V170.102H107.62V171.977H112.116V174.364H107.62V176.239H112.499V178.625H104.658Z" />
      <path d="M117.164 167.716L118.954 170.891H119.039L120.85 167.716H124.153L120.893 173.17L124.28 178.625H120.893L119.039 175.386H118.954L117.1 178.625H113.734L117.079 173.17L113.84 167.716H117.164Z" />
      <path d="M138.603 171.807H135.598C135.577 171.558 135.52 171.333 135.428 171.13C135.339 170.928 135.215 170.754 135.055 170.608C134.899 170.459 134.709 170.346 134.485 170.267C134.261 170.186 134.007 170.145 133.723 170.145C133.226 170.145 132.805 170.266 132.461 170.507C132.12 170.749 131.861 171.095 131.683 171.546C131.509 171.997 131.422 172.538 131.422 173.17C131.422 173.838 131.511 174.397 131.689 174.848C131.87 175.296 132.131 175.633 132.472 175.86C132.812 176.084 133.223 176.196 133.702 176.196C133.975 176.196 134.221 176.162 134.437 176.095C134.654 176.024 134.842 175.923 135.002 175.791C135.162 175.66 135.291 175.502 135.391 175.317C135.494 175.129 135.563 174.918 135.598 174.683L138.603 174.705C138.567 175.166 138.437 175.637 138.214 176.116C137.99 176.592 137.672 177.032 137.26 177.437C136.852 177.838 136.346 178.162 135.742 178.407C135.138 178.652 134.437 178.774 133.638 178.774C132.637 178.774 131.738 178.559 130.943 178.13C130.151 177.7 129.524 177.068 129.062 176.233C128.604 175.399 128.375 174.378 128.375 173.17C128.375 171.956 128.61 170.933 129.078 170.102C129.547 169.268 130.179 168.637 130.975 168.211C131.77 167.782 132.658 167.567 133.638 167.567C134.327 167.567 134.961 167.661 135.54 167.849C136.119 168.037 136.626 168.312 137.063 168.675C137.5 169.033 137.852 169.475 138.118 170.001C138.384 170.527 138.546 171.129 138.603 171.807Z" />
      <path d="M150.514 173.17C150.514 174.385 150.278 175.409 149.806 176.244C149.334 177.075 148.696 177.705 147.894 178.135C147.091 178.561 146.196 178.774 145.209 178.774C144.215 178.774 143.316 178.559 142.514 178.13C141.715 177.696 141.079 177.064 140.607 176.233C140.138 175.399 139.904 174.378 139.904 173.17C139.904 171.956 140.138 170.933 140.607 170.102C141.079 169.268 141.715 168.637 142.514 168.211C143.316 167.782 144.215 167.567 145.209 167.567C146.196 167.567 147.091 167.782 147.894 168.211C148.696 168.637 149.334 169.268 149.806 170.102C150.278 170.933 150.514 171.956 150.514 173.17ZM147.468 173.17C147.468 172.517 147.381 171.967 147.207 171.519C147.036 171.068 146.782 170.727 146.445 170.496C146.111 170.262 145.699 170.145 145.209 170.145C144.719 170.145 144.305 170.262 143.968 170.496C143.634 170.727 143.38 171.068 143.206 171.519C143.036 171.967 142.951 172.517 142.951 173.17C142.951 173.824 143.036 174.376 143.206 174.827C143.38 175.275 143.634 175.615 143.968 175.85C144.305 176.081 144.719 176.196 145.209 176.196C145.699 176.196 146.111 176.081 146.445 175.85C146.782 175.615 147.036 175.275 147.207 174.827C147.381 174.376 147.468 173.824 147.468 173.17Z" />
      <path d="M156.082 178.625H151.885V167.716H156.04C157.162 167.716 158.131 167.934 158.948 168.371C159.768 168.804 160.4 169.429 160.844 170.246C161.292 171.059 161.515 172.034 161.515 173.17C161.515 174.307 161.294 175.283 160.85 176.1C160.406 176.913 159.777 177.538 158.964 177.975C158.151 178.408 157.19 178.625 156.082 178.625ZM154.846 176.111H155.976C156.515 176.111 156.975 176.024 157.355 175.85C157.739 175.676 158.03 175.376 158.229 174.95C158.431 174.523 158.532 173.93 158.532 173.17C158.532 172.411 158.43 171.817 158.224 171.391C158.021 170.965 157.723 170.665 157.329 170.491C156.938 170.317 156.459 170.23 155.89 170.23H154.846V176.111Z" />
      <path d="M162.886 178.625V167.716H170.748V170.102H165.847V171.977H170.343V174.364H165.847V176.239H170.727V178.625H162.886Z" />
    </motion.g>
  );
}
